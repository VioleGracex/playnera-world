# playnera-world
 
# Документация по системе перетаскивания

## Обзор

Эта документация предоставляет обзор системы перетаскивания, включая компоненты `Draggable`, `DraggableItem`, `DraggablePerson`, `DragAndDropManager` и `CharacterPoseInfo`. Она также включает пошаговые руководства по настройке перетаскиваемых предметов, персонажей и мебели в Unity.

## Draggable

Класс `Draggable` является базовым классом для всех перетаскиваемых объектов. Он содержит общие свойства и методы для обработки перетаскивания и симуляции гравитации.

### Свойства

- `InitialScale`: Начальный масштаб перетаскиваемого объекта.
- `Type`: Тип перетаскиваемого объекта (абстрактный, должен быть определен в производных классах).
- `OverlapSize`: Размер области перекрытия для проверки размещения.
- `OverlapOffset`: Смещение области перекрытия для проверки размещения.

### Методы

- `AdjustOrderInLayer()`: Регулирует порядок сортировки на основе позиции по оси y.
- `StartDragging()`: Вызывается при начале перетаскивания.
- `StopDragging(bool validPlacement)`: Вызывается при остановке перетаскивания.
- `StopFallingAndReturnToNormalScale(Collider2D collider = null)`: Останавливает симуляцию гравитации и возвращает объект к исходному масштабу.
- `SmoothScale(Transform target, Vector3 targetScale, float speed)`: Плавно изменяет масштаб объекта.

## DraggableItem

Класс `DraggableItem` наследует от `Draggable` и представляет собой перетаскиваемый предмет. Он включает дополнительные свойства, специфичные для предметов.

### Свойства

- `Type`: Возвращает тип перетаскиваемого объекта (Item).
- `canBeHeld`: Указывает, может ли предмет быть удерживаемым персонажем.

## DraggablePerson

Класс `DraggablePerson` наследует от `Draggable` и представляет собой перетаскиваемого персонажа. Он включает дополнительные свойства и методы, специфичные для персонажей.

### Свойства

- `Type`: Возвращает тип перетаскиваемого объекта (Person).
- `HeldItem`: Предмет, который в данный момент удерживает персонаж (если есть).
- `currentPose`: Текущая поза персонажа.

### Методы

- `ChangePoseByLayer(string layerName)`: Изменяет позу персонажа в зависимости от слоя.
- `ChangePoseTo(string pose)`: Изменяет позу персонажа на конкретную позу.
- `ValidatePose()`: Проверяет текущую позу персонажа.
- `ValidateHoveredOnPose(DraggableItem item)`: Проверяет позу при наведении на предмет.
- `HoldItem(DraggableItem item)`: Заставляет персонажа удерживать предмет.
- `ReleaseItem()`: Отпускает удерживаемый предмет.

## DragAndDropManager

`DragAndDropManager` обрабатывает взаимодействия перетаскивания, включая начало и остановку процесса перетаскивания и проверку допустимости размещения.

### Методы

- `StartDragging(Draggable draggable, Vector3 touchPosition)`: Начинает перетаскивание указанного объекта.
- `StopDragging()`: Останавливает процесс перетаскивания.
- `CheckPlacement()`: Проверяет, находится ли текущий перетаскиваемый объект в допустимой зоне размещения.
- `CheckHoverPerson()`: Проверяет, находится ли перетаскиваемый персонаж над допустимой зоной.
- `CheckHoverItem()`: Проверяет, находится ли перетаскиваемый предмет над допустимой зоной.
- `SmoothScale(Transform target, Vector3 targetScale, float speed)`: Плавно изменяет масштаб объекта.
- `OnDrawGizmos()`: Рисует гизмы для отладки.
- `SetHeldItemSortingOrder(DraggablePerson draggablePerson)`: Устанавливает порядок сортировки для удерживаемого предмета.
- `ReleaseParentItem()`: Отпускает родительский предмет.
- `HandleScaleForHover(string layerName)`: Обрабатывает изменение масштаба при наведении на конкретный слой.

## CharacterPoseInfo

Класс `CharacterPoseInfo` содержит информацию о позах персонажей и их допустимых взаимодействиях.

### Свойства

- `layerPriority`: Словарь, сопоставляющий имена слоев с их приоритетом для проверки размещения.
- `Instance`: Одиночный экземпляр `CharacterPoseInfo`.

### Методы

- `GetPoseFromLayer(string layerName)`: Получает позу, связанную с указанным слоем.
- `IsPoseAllowedToHoldItem(string poseName)`: Проверяет, допускает ли конкретная поза удержание предмета.
- `ValidatePose()`: Проверяет текущую позу персонажа.
- `ValidateHoveredOnPose(DraggableItem item)`: Проверяет позу при наведении на предмет.

## Контроллер камеры

Скрипт `CameraController` управляет движением камеры и прокруткой края экрана при удержании предмета или персонажа.

### Методы

- `MoveCamera(Vector3 difference)`: Перемещает камеру на основе вектора разницы.
- `HandleEdgeScrolling(Vector3 draggablePosition)`: Обрабатывает прокрутку края экрана при перетаскивании предмета.
- `StartSpriteDrag(Draggable draggable)`: Начинает перетаскивание спрайта.
- `EndSpriteDrag()`: Заканчивает перетаскивание спрайта.
- `EdgeScroll()`: Корутин для прокрутки края экрана.

### Настройка

1. **Присоедините к главной камере**: Присоедините скрипт `CameraController` к главной камере.
2. **Настройте значения**: Настройте значения для оптимальной плавной прокрутки.

## Пошаговое руководство

### Создание стула, дивана, полки или стола

1. **Создайте GameObject**: Создайте пустой GameObject и присвойте компонент `SpriteRenderer`.
2. **Добавьте коллайдер**: Добавьте компонент `PolygonCollider2D` для определения области столкновения.
3. **Назначьте слой**: Назначьте GameObject на соответствующий слой (например, "Furniture").
4. **Дополнительно**: Назначьте скрипт порядка сортировки для автоматической сортировки по оси y.

### Создание перетаскиваемого предмета

1. **Создайте GameObject**: Создайте пустой GameObject и присвойте компонент `SpriteRenderer`.
2. **Добавьте коллайдер**: Добавьте компонент `PolygonCollider2D` для определения области столкновения.
3. **Назначьте слой**: Назначьте GameObject на соответствующий слой (например, "Item").
4. **Добавьте скрипт DraggableItem**: Присоедините скрипт `DraggableItem` к GameObject.
5. **Настройте свойства**:
   - Определите `OverlapOffset` и `OverlapSize`.
   - Установите `validPlacementLayerMask` для указания допустимых слоев для размещения.
   - Настройте параметры падения для симуляции гравитации.
   - Установите `canBeHeld`, чтобы указать, может ли предмет быть удерживаемым персонажем.

### Создание перетаскиваемого персонажа

1. **Создайте GameObject**: Создайте пустой GameObject и присвойте компонент `SpriteRenderer`.
2. **Добавьте коллайдер**: Добавьте компонент `PolygonCollider2D` для определения области столкновения.
3. **Назначьте слой**: Назначьте GameObject на соответствующий слой (например, "Person").
4. **Добавьте скрипт DraggablePerson**: Присоедините скрипт `DraggablePerson` к GameObject.
5. **Настройте свойства**:
   - Определите `OverlapOffset` и `OverlapSize`.
   - Установите `validPlacementLayerMask` для указания допустимых слоев для размещения.
   - Настройте параметры падения для симуляции гравитации.
   - Установите `handLocation`, чтобы определить, где персонаж удерживает предметы.
   - Определите `poseSpritesList` с позами и соответствующими спрайтами.
   - Настройте `sittingOffset` и `sleepingOffset`, чтобы настроить позицию персонажа для разных поз.

### Настройка Drag and Drop Manager

1. **Создайте пустой GameObject**: Назовите его `DragAndDropManager` и присоедините скрипт `DragAndDropManager`.
2. **Назначьте слой перетаскиваемых объектов**: Установите поле `draggableLayer` на соответствующую маску слоя.
3. **Установите скорость масштабирования**: Настройте поле `scaleSpeed` для плавного масштабирования.

### Настройка контроллера камеры

1. **Присоедините к главной камере**: Присоедините скрипт `CameraController` к главной камере.
2. **Настройте значения**: Настройте значения для оптимальной плавной прокрутки.
